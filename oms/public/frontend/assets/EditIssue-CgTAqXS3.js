var C=Object.defineProperty;var h=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var j=(u,a,o)=>a in u?C(u,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):u[a]=o,k=(u,a)=>{for(var o in a||(a={}))O.call(a,o)&&j(u,o,a[o]);if(h)for(var o of h(a))R.call(a,o)&&j(u,o,a[o]);return u};var x=(u,a,o)=>new Promise((s,p)=>{var m=i=>{try{b(o.next(i))}catch(r){p(r)}},g=i=>{try{b(o.throw(i))}catch(r){p(r)}},b=i=>i.done?s(i.value):Promise.resolve(i.value).then(m,g);b((o=o.apply(u,a)).next())});import{r as v,b as V,c as n,a as t,e as U,f as P,h as N,i as f,v as y,m as _,F as D,g as T,p as E,j as S,t as I,D as $,u as F,o as d}from"./index-Cw_GSGqn.js";import{r as M}from"./ChevronLeftIcon-BHl7YYgo.js";const B={class:"p-4 max-w-3xl mx-auto"},J={class:"flex items-center mb-6"},A=["value"],H={key:0,class:"mb-2"},L=["src"],q={key:0,class:"mb-2"},Y=["href"],z=["disabled"],G={key:1,class:"flex justify-center items-center h-64"},K={key:2,class:"bg-white rounded-lg shadow-md p-6 text-center"},Z={__name:"EditIssue",setup(u){const a=$(),o=F(),s=v(null),p=v(!0),m=v(!1),g=v([]),b=r=>{const e=event.target;if(e.files.length>0){const l=e.files[0],c=new FileReader;c.onload=w=>{r==="image"?s.value.custom_issue_image=w.target.result:s.value.custom_other_attachment=w.target.result},c.readAsDataURL(l)}},i=()=>x(this,null,function*(){m.value=!0;try{yield fetch("/api/method/frappe.client.save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k({doctype:"Issue"},s.value))}),o.push(`/issue/${s.value.name}`)}catch(r){console.error("Error updating issue:",r),alert("Error updating issue. Please try again.")}finally{m.value=!1}});return V(()=>x(this,null,function*(){try{const[r,e]=yield Promise.all([fetch("/api/method/frappe.client.get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doctype:"Issue",name:a.params.id})}),fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doctype:"Project",fields:["name","project_name"],filters:{is_active:"Yes"},limit:50})})]),[l,c]=yield Promise.all([r.json(),e.json()]);l.message&&(s.value=l.message),c.message&&(g.value=c.message)}catch(r){console.error("Error fetching data:",r)}finally{p.value=!1}})),(r,e)=>(d(),n("div",B,[t("div",J,[t("button",{onClick:e[0]||(e[0]=l=>r.$router.back()),class:"mr-2"},[U(P(M),{class:"h-6 w-6 text-gray-600"})]),e[9]||(e[9]=t("h2",{class:"text-2xl font-bold text-gray-800"},"Edit Issue",-1))]),s.value?(d(),n("form",{key:0,onSubmit:N(i,["prevent"]),class:"bg-white rounded-lg shadow-md p-6 space-y-6"},[t("div",null,[e[10]||(e[10]=t("label",{for:"subject",class:"block text-sm font-medium text-gray-700 mb-1"},"Subject",-1)),f(t("input",{id:"subject","onUpdate:modelValue":e[1]||(e[1]=l=>s.value.subject=l),type:"text",required:"",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[y,s.value.subject]])]),t("div",null,[e[12]||(e[12]=t("label",{for:"project",class:"block text-sm font-medium text-gray-700 mb-1"},"Project",-1)),f(t("select",{id:"project","onUpdate:modelValue":e[2]||(e[2]=l=>s.value.project=l),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},[e[11]||(e[11]=t("option",{value:""},"Select Project",-1)),(d(!0),n(D,null,T(g.value,l=>(d(),n("option",{key:l.name,value:l.name},I(l.project_name),9,A))),128))],512),[[_,s.value.project]])]),t("div",null,[e[14]||(e[14]=t("label",{for:"status",class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),f(t("select",{id:"status","onUpdate:modelValue":e[3]||(e[3]=l=>s.value.status=l),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},e[13]||(e[13]=[E('<option value="Open">Open</option><option value="Replied">Replied</option><option value="Closed">Closed</option><option value="Resolved">Resolved</option><option value="On Hold">On Hold</option>',5)]),512),[[_,s.value.status]])]),t("div",null,[e[15]||(e[15]=t("label",{for:"raised_by",class:"block text-sm font-medium text-gray-700 mb-1"},"Raised by Contact",-1)),f(t("input",{id:"raised_by","onUpdate:modelValue":e[4]||(e[4]=l=>s.value.custom_raised_by_contact=l),type:"text",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[y,s.value.custom_raised_by_contact]])]),t("div",null,[e[16]||(e[16]=t("label",{for:"mobile",class:"block text-sm font-medium text-gray-700 mb-1"},"Contact Number",-1)),f(t("input",{id:"mobile","onUpdate:modelValue":e[5]||(e[5]=l=>s.value.custom_raised_by_mobile=l),type:"tel",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[y,s.value.custom_raised_by_mobile]])]),t("div",null,[e[17]||(e[17]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700 mb-1"},"Description",-1)),f(t("textarea",{id:"description","onUpdate:modelValue":e[6]||(e[6]=l=>s.value.description=l),rows:"4",class:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"},null,512),[[y,s.value.description]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Issue Image",-1)),s.value.custom_issue_image?(d(),n("div",H,[t("img",{src:s.value.custom_issue_image,alt:"Issue Image",class:"max-w-full h-auto rounded-lg shadow-md"},null,8,L)])):S("",!0),t("input",{type:"file",onChange:e[7]||(e[7]=l=>b("image")),accept:"image/*",class:"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Other Attachment",-1)),s.value.custom_other_attachment?(d(),n("div",q,[t("a",{href:s.value.custom_other_attachment,target:"_blank",class:"text-blue-600 hover:underline"},"View current attachment",8,Y)])):S("",!0),t("input",{type:"file",onChange:e[8]||(e[8]=l=>b("other")),class:"w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,32)]),t("button",{type:"submit",class:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors",disabled:m.value},I(m.value?"Updating...":"Update Issue"),9,z)],32)):p.value?(d(),n("div",G,e[20]||(e[20]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)]))):(d(),n("div",K,e[21]||(e[21]=[t("p",{class:"text-gray-600"},"Issue not found",-1)])))]))}};export{Z as default};
