var P=(h,a,m)=>new Promise((y,i)=>{var u=o=>{try{c(m.next(o))}catch(p){i(p)}},d=o=>{try{c(m.throw(o))}catch(p){i(p)}},c=o=>o.done?y(o.value):Promise.resolve(o.value).then(u,d);c((m=m.apply(h,a)).next())});import{o as l,c as r,a as e,r as v,s as V,w as U,b as Z,d as q,k as C,v as z,e as w,f as x,n as j,t as g,i as S,x as B,h as E,q as J,F as Q,g as G}from"./index-CYN7HMaP.js";import{r as K}from"./UserIcon-DUh7elX0.js";function W(h,a){return l(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})])}function X(h,a){return l(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 3v1.5M3 21v-6m0 0 2.77-.693a9 9 0 0 1 6.208.682l.108.054a9 9 0 0 0 6.086.71l3.114-.732a48.524 48.524 0 0 1-.005-10.499l-3.11.732a9 9 0 0 1-6.085-.711l-.108-.054a9 9 0 0 0-6.208-.682L3 4.5M3 15V4.5"})])}function Y(h,a){return l(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"})])}function ee(h,a){return l(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"})])}function te(h,a){return l(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function se(h,a){return l(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}const oe={class:"p-4"},ne={class:"bg-white rounded-lg shadow-sm p-2 mb-4 sticky top-0 z-50"},le={class:"flex items-center gap-2"},re={class:"flex-1 relative"},ae={class:"relative"},ie={key:0,class:"absolute -top-1 -right-1 bg-blue-600 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center"},ue={key:0,class:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg z-50 p-3 border filter-dropdown"},de={class:"mb-3"},ce={class:"mb-3"},pe={key:0,class:"flex justify-center items-center py-8"},ve={key:1,class:"bg-white rounded-lg shadow-md p-6 text-center"},ge={key:2,class:"space-y-4"},he=["onClick"],me={class:"flex justify-between items-start"},fe={class:"flex-1"},be={class:"flex items-center space-x-2"},we={class:"text-sm text-gray-500"},xe={class:"font-semibold text-gray-800 mt-1"},ye={class:"flex flex-wrap gap-4 mt-2"},_e={class:"flex items-center text-sm text-gray-500"},ke={class:"flex items-center text-sm text-gray-500"},Ce={class:"flex items-center text-sm text-gray-500"},je={key:3,class:"mt-6 flex justify-between items-center"},Se=["disabled"],$e={class:"text-sm text-gray-600"},Me=["disabled"],$=20,Be={__name:"Issue",setup(h){const a=v([]),m=v(!0),y=v(null),i=v(!1),u=v(""),d=v(""),c=v("creation desc"),o=v(1),p=v(1),_=V(()=>d.value!==""||u.value!==""),L=V(()=>{let n=0;return d.value&&n++,u.value&&n++,n}),R=n=>{switch(n){case"Open":return"bg-yellow-100 text-yellow-800";case"Closed":return"bg-green-100 text-green-800";case"Resolved":return"bg-blue-100 text-blue-800";case"On Hold":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},T=()=>{d.value="",c.value="creation desc",u.value="",i.value=!1,o.value=1,f()},A=()=>{i.value=!1,o.value=1,f()};let M;const F=()=>{clearTimeout(M),M=setTimeout(()=>{o.value=1,f()},300)},I=()=>{o.value>1&&(o.value--,f())},H=()=>{o.value<p.value&&(o.value++,f())},f=()=>P(this,null,function*(){m.value=!0;try{const t=yield(yield fetch("/api/method/oms.api.get_current_user_info")).json();y.value=t.message;const s={raised_by:y.value.name};d.value&&(s.status=d.value);let b=[];if(u.value.trim()){const k=u.value.trim();b.push(["Issue","name","like",`%${k}%`]),b.push(["Issue","subject","like",`%${k}%`])}const O=yield(yield fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doctype:"Issue",fields:["name","subject","project","status","custom_raised_by_contact","raised_by","priority","creation"],filters:s,or_filters:b.length>0?b:void 0,limit_start:(o.value-1)*$,limit_page_length:$,order_by:c.value})})).json();if(O.message){a.value=O.message;const D=yield(yield fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doctype:"Issue",fields:["name"],filters:s,or_filters:b.length>0?b:void 0,limit_page_length:0})})).json();p.value=Math.ceil(D.message.length/$)}}catch(n){console.error("Error fetching issues:",n)}finally{m.value=!1}});U(c,()=>{o.value=1,f()});const N=n=>{const t=document.querySelector(".filter-dropdown"),s=document.querySelector(".filter-toggle-btn");i.value&&t&&!t.contains(n.target)&&!s.contains(n.target)&&(i.value=!1)};return Z(()=>{f(),document.addEventListener("click",N)}),q(()=>{document.removeEventListener("click",N)}),(n,t)=>(l(),r("div",oe,[e("div",ne,[e("div",le,[e("div",re,[C(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>u.value=s),type:"text",placeholder:"Search by ID or subject...",class:"w-full pl-8 pr-2 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onInput:F},null,544),[[z,u.value]]),w(x(te),{class:"h-4 w-4 text-gray-400 absolute left-2 top-2.5"})]),e("div",ae,[e("button",{onClick:t[1]||(t[1]=s=>i.value=!i.value),class:j(["p-2 border rounded-lg hover:bg-gray-50 relative filter-toggle-btn",{"bg-blue-50 border-blue-300":_.value}])},[w(x(ee),{class:j(["h-5 w-5",_.value?"text-blue-600":"text-gray-600"])},null,8,["class"]),_.value?(l(),r("span",ie,g(L.value),1)):S("",!0)],2),i.value?(l(),r("div",ue,[e("div",de,[t[7]||(t[7]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Status",-1)),C(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>d.value=s),class:"w-full border rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},t[6]||(t[6]=[E('<option value="">All Status</option><option value="Open">Open</option><option value="Closed">Closed</option><option value="Resolved">Resolved</option><option value="Replied">Replied</option><option value="On Hold">On Hold</option>',6)]),512),[[B,d.value]])]),e("div",ce,[t[9]||(t[9]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Sort By",-1)),C(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>c.value=s),class:"w-full border rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},t[8]||(t[8]=[e("option",{value:"creation desc"},"Newest First",-1),e("option",{value:"creation asc"},"Oldest First",-1),e("option",{value:"priority desc"},"Priority (High to Low)",-1),e("option",{value:"priority asc"},"Priority (Low to High)",-1)]),512),[[B,c.value]])]),e("div",{class:"flex justify-between"},[e("button",{onClick:T,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Reset "),e("button",{onClick:A,class:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," Apply ")])])):S("",!0)]),e("button",{onClick:t[4]||(t[4]=s=>n.$router.push("/issue/new")),class:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center"},[w(x(se),{class:"h-5 w-5 mr-1"}),t[10]||(t[10]=J(" New "))])])]),m.value?(l(),r("div",pe,t[11]||(t[11]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)]))):a.value.length===0?(l(),r("div",ve,[w(x(W),{class:"h-12 w-12 mx-auto text-gray-400 mb-2"}),t[12]||(t[12]=e("p",{class:"text-gray-600"},"No issues found",-1)),e("button",{onClick:t[5]||(t[5]=s=>n.$router.push("/issue/new")),class:"mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg"}," Create New Issue ")])):(l(),r("div",ge,[(l(!0),r(Q,null,G(a.value,s=>(l(),r("div",{key:s.name,onClick:b=>n.$router.push(`/issue/${s.name}`),class:"bg-white rounded-lg shadow-md p-4 cursor-pointer hover:shadow-lg transition-shadow"},[e("div",me,[e("div",fe,[e("div",be,[e("span",we,g(s.name),1),e("div",{class:j([R(s.status),"px-2 py-0.5 rounded-full text-xs font-medium"])},g(s.status),3)]),e("h3",xe,g(s.subject),1),e("div",ye,[e("div",_e,[w(x(Y),{class:"h-4 w-4 mr-1"}),e("span",null,g(s.project||"No Project"),1)]),e("div",ke,[w(x(X),{class:"h-4 w-4 mr-1"}),e("span",null,"Priority: "+g(s.priority||"Medium"),1)]),e("div",Ce,[w(x(K),{class:"h-4 w-4 mr-1"}),e("span",null,g(s.custom_raised_by_contact||s.raised_by||"Unknown"),1)])])])])],8,he))),128))])),p.value>1?(l(),r("div",je,[e("button",{onClick:I,disabled:o.value===1,class:"px-4 py-2 bg-white border rounded-lg disabled:opacity-50"}," Previous ",8,Se),e("span",$e," Page "+g(o.value)+" of "+g(p.value),1),e("button",{onClick:H,disabled:o.value===p.value,class:"px-4 py-2 bg-white border rounded-lg disabled:opacity-50"}," Next ",8,Me)])):S("",!0)]))}};export{Be as default};
