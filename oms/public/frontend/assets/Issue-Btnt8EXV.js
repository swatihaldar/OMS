var z=Object.defineProperty;var B=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var O=(u,a,l)=>a in u?z(u,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[a]=l,$=(u,a)=>{for(var l in a||(a={}))E.call(a,l)&&O(u,l,a[l]);if(B)for(var l of B(a))J.call(a,l)&&O(u,l,a[l]);return u};var A=(u,a,l)=>new Promise((w,g)=>{var c=d=>{try{r(l.next(d))}catch(x){g(x)}},m=d=>{try{r(l.throw(d))}catch(x){g(x)}},r=d=>d.done?w(d.value):Promise.resolve(d.value).then(c,m);r((l=l.apply(u,a)).next())});import{o as n,c as i,a as e,r as p,l as S,w as q,b as G,i as L,v as K,e as h,f,n as M,t as v,j as b,k as Q,m as F,p as W,F as X,g as Y}from"./index-Cw_GSGqn.js";import{r as ee}from"./UserIcon-dlnVkgXH.js";function te(u,a){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"})])}function se(u,a){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 3v1.5M3 21v-6m0 0 2.77-.693a9 9 0 0 1 6.208.682l.108.054a9 9 0 0 0 6.086.71l3.114-.732a48.524 48.524 0 0 1-.005-10.499l-3.11.732a9 9 0 0 1-6.085-.711l-.108-.054a9 9 0 0 0-6.208-.682L3 4.5M3 15V4.5"})])}function oe(u,a){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"})])}function ae(u,a){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"})])}function re(u,a){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function le(u,a){return n(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}const ne={class:"p-4"},ie={class:"bg-white rounded-lg shadow-sm p-2 mb-4 sticky top-0 z-50"},ue={class:"flex items-center gap-2"},de={class:"flex-1 relative"},ce={key:0,class:"absolute -top-1 -right-1 bg-blue-600 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center"},pe={key:0,class:"mt-3 border-t pt-3 space-y-3"},ve={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},ge={class:"flex justify-end space-x-2"},me={key:0,class:"flex justify-center items-center py-8"},he={key:1,class:"bg-white rounded-lg shadow-md p-6 text-center"},fe={key:2,class:"space-y-4"},be=["onClick"],we={class:"flex justify-between items-start"},xe={class:"flex-1"},ye={class:"flex items-center space-x-2"},_e={class:"text-sm text-gray-500"},ke={class:"font-semibold text-gray-800 mt-1"},Ce={class:"flex flex-wrap gap-4 mt-2"},je={key:0,class:"flex items-center text-sm text-gray-500"},$e={key:1,class:"flex items-center text-sm text-gray-500"},Se={key:2,class:"flex items-center text-sm text-gray-500"},Le={key:3,class:"mt-6 flex justify-between items-center"},Me=["disabled"],Ne={class:"text-sm text-gray-600"},Pe=["disabled"],N=20,Fe={__name:"Issue",setup(u){const a=p([]),l=p(!0),w=p(null),g=p(!1),c=p(1),m=p(1),r=p({search:"",status:""}),d=p("creation desc"),x=p(["project","priority","raised_by"]),k=S(()=>r.value.status!==""||d.value!=="creation desc"),T=S(()=>{let o=0;return r.value.status&&o++,d.value!=="creation desc"&&o++,o}),C=o=>x.value.includes(o),R=()=>{r.value.status="",d.value="creation desc",_()},H=o=>{switch(o){case"Open":return"bg-yellow-100 text-yellow-800";case"Closed":return"bg-green-100 text-green-800";case"Resolved":return"bg-blue-100 text-blue-800";case"On Hold":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},P=S(()=>{let o=[...a.value];if(r.value.search){const t=r.value.search.toLowerCase();o=o.filter(s=>s.name.toLowerCase().includes(t)||s.subject.toLowerCase().includes(t))}return r.value.status&&(o=o.filter(t=>t.status===r.value.status)),o});let V;const I=()=>{clearTimeout(V),V=setTimeout(()=>{_()},300)},U=()=>{c.value>1&&(c.value--,y())},Z=()=>{c.value<m.value&&(c.value++,y())},y=()=>A(this,null,function*(){l.value=!0;try{const t=yield(yield fetch("/api/method/oms.api.get_current_user_info")).json();w.value=t.message;const j=yield(yield fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doctype:"Issue",fields:["name","subject","project","status","custom_raised_by_contact","raised_by","priority","creation"],filters:$({raised_by:w.value.name},r.value.status&&{status:r.value.status}),limit_start:(c.value-1)*N,limit_page_length:N,order_by:d.value})})).json();if(j.message){a.value=j.message;const D=yield(yield fetch("/api/method/frappe.client.get_list",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({doctype:"Issue",fields:["name"],filters:$({raised_by:w.value.name},r.value.status&&{status:r.value.status}),limit_page_length:0})})).json();m.value=Math.ceil(D.message.length/N)}}catch(o){console.error("Error fetching issues:",o)}finally{l.value=!1}});q([r,d],()=>{c.value=1,y()});const _=()=>{y()};return G(()=>{y(),document.addEventListener("click",o=>{!o.target.closest(".filter-panel")&&!o.target.closest("button")&&(g.value=!1)})}),(o,t)=>(n(),i("div",ne,[e("div",ie,[e("div",ue,[e("div",de,[L(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>r.value.search=s),type:"text",placeholder:"Search...",class:"w-full pl-8 pr-2 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onInput:I},null,544),[[K,r.value.search]]),h(f(re),{class:"h-4 w-4 text-gray-400 absolute left-2 top-2.5"})]),e("button",{onClick:t[1]||(t[1]=s=>g.value=!g.value),class:M(["p-2 border rounded-lg hover:bg-gray-50 relative",{"bg-blue-50 border-blue-300":k.value}])},[h(f(ae),{class:M(["h-5 w-5",k.value?"text-blue-600":"text-gray-600"])},null,8,["class"]),k.value?(n(),i("span",ce,v(T.value),1)):b("",!0)],2),e("button",{onClick:t[2]||(t[2]=s=>o.$router.push("/issue/new")),class:"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center"},[h(f(le),{class:"h-5 w-5 mr-1"}),t[7]||(t[7]=Q(" New "))])]),g.value?(n(),i("div",pe,[e("div",ve,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Status",-1)),L(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>r.value.status=s),class:"w-full border rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onChange:_},t[8]||(t[8]=[W('<option value="">All Status</option><option value="Open">Open</option><option value="Closed">Closed</option><option value="Resolved">Resolved</option><option value="On Hold">On Hold</option>',5)]),544),[[F,r.value.status]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-xs font-medium text-gray-700 mb-1"},"Sort By",-1)),L(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>d.value=s),class:"w-full border rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500",onChange:_},t[10]||(t[10]=[e("option",{value:"creation desc"},"Newest First",-1),e("option",{value:"creation asc"},"Oldest First",-1),e("option",{value:"priority desc"},"Priority (High to Low)",-1),e("option",{value:"priority asc"},"Priority (Low to High)",-1)]),544),[[F,d.value]])])]),e("div",ge,[e("button",{onClick:R,class:"px-3 py-1.5 text-sm border rounded-lg hover:bg-gray-50"}," Reset "),e("button",{onClick:t[5]||(t[5]=s=>g.value=!1),class:"px-3 py-1.5 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," Apply ")])])):b("",!0)]),l.value?(n(),i("div",me,t[12]||(t[12]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)]))):P.value.length===0?(n(),i("div",he,[h(f(te),{class:"h-12 w-12 mx-auto text-gray-400 mb-2"}),t[13]||(t[13]=e("p",{class:"text-gray-600"},"No issues found",-1)),e("button",{onClick:t[6]||(t[6]=s=>o.$router.push("/issue/new")),class:"mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg"}," Create New Issue ")])):(n(),i("div",fe,[(n(!0),i(X,null,Y(P.value,s=>(n(),i("div",{key:s.name,onClick:j=>o.$router.push(`/issue/${s.name}`),class:"bg-white rounded-lg shadow-md p-4 cursor-pointer hover:shadow-lg transition-shadow"},[e("div",we,[e("div",xe,[e("div",ye,[e("span",_e,v(s.name),1),e("div",{class:M([H(s.status),"px-2 py-0.5 rounded-full text-xs font-medium"])},v(s.status),3)]),e("h3",ke,v(s.subject),1),e("div",Ce,[C("project")?(n(),i("div",je,[h(f(oe),{class:"h-4 w-4 mr-1"}),e("span",null,v(s.project||"No Project"),1)])):b("",!0),C("priority")?(n(),i("div",$e,[h(f(se),{class:"h-4 w-4 mr-1"}),e("span",null,"Priority: "+v(s.priority||"Medium"),1)])):b("",!0),C("raised_by")?(n(),i("div",Se,[h(f(ee),{class:"h-4 w-4 mr-1"}),e("span",null,v(s.custom_raised_by_contact||s.raised_by||"Unknown"),1)])):b("",!0)])])])],8,be))),128))])),m.value>1?(n(),i("div",Le,[e("button",{onClick:U,disabled:c.value===1,class:"px-4 py-2 bg-white border rounded-lg disabled:opacity-50"}," Previous ",8,Me),e("span",Ne," Page "+v(c.value)+" of "+v(m.value),1),e("button",{onClick:Z,disabled:c.value===m.value,class:"px-4 py-2 bg-white border rounded-lg disabled:opacity-50"}," Next ",8,Pe)])):b("",!0)]))}};export{Fe as default};
